<!--Author Isaac de Cuba-->
<!--Editor Adriel Walter, Serhildan Akdeniz-->
<div class="container">
    <div class="row">
        <form class="navbar-form" role="search" action="/result">
            <div class="input-group">
                <input type="text" name="search" class="form-control" placeholder="Zoeken naar ..."/>
                    <span class="input-group-btn">
                        <button class="btn btn-default" type="submit">
                            <span class="glyphicon glyphicon-search"></span>
                        </button>
                    </span>
            </div>
        </form>
        <div class="col-md-4">
            <h3>Beschikbare huizen</h3>
        </div>
        <div class="col-md-8">
            <h3>Map</h3>
        </div>
    </div>
    <div class="row">
        <div class="col-md-4 col-sm-3 pre-scrollable">
            <ul class="list-group">
                <!--                this parameter is temporary set like this when using filter should be removed-->
                <?php $params['filters']['city'] = $this->search; ?>

                <?php $collection = $this->fundaAanbod->getCollection($params); ?>

                <script>
                    var collection = <?php echo json_encode($collection); ?>;
                    var lat = <?php echo json_encode($this->lat); ?>;
                    var lng = <?php echo json_encode($this->lng); ?>;

                </script>
                <?php foreach ($collection as $house): ?>
                    <li class="list-group-item">
                        <?php echo sprintf('Adres: %s', $house->Adres) . "<br>"; ?>
                        <?php echo sprintf('Aantal kamers: %s', $house->AantalKamers) . "<br>"; ?>
                        <?php echo sprintf('Koop prijs: %s,- euro', $house->Koopprijs) . "<br>"; ?>
                    </li>
                <?php endforeach; ?>

                <div class="row">
                    <div class="col-md-12 dev-mode" align="center">
                        <ul class="pagination">
                            <li class="disabled"><a href="#">&laquo;</a></li>
                            <li class="active"><a href="#">1</a></li>
                            <li><a href="#">2</a></li>
                            <li><a href="#">3</a></li>
                            <li><a href="#">4</a></li>
                            <li><a href="#">5</a></li>
                            <li><a href="#">&raquo;</a></li>
                        </ul>
                    </div>
                </div>
            </ul>
        </div>
        <div class="col-md-8 col-sm-9">
            <div id="map-canvas"/>
        </div>
        <script>
            var map;
            var infoWindow = new google.maps.InfoWindow();
            var infoPopUp = new google.maps.InfoWindow();

            function initialize() {
                var mapOptions = {
                    minZoom: 8, //minimum zoom level van de kaart
                    zoom: 12,
                    center: new google.maps.LatLng(lat, lng),
                    disableDefaultUI: true,
                    mapTypeControl: false,
                    zoomControl: true
                }
                map = new google.maps.Map(document.getElementById('map-canvas'),
                    mapOptions);

                for (var i = 0; i < collection.length; i++) {
                    housePhoto = '<img src="' + collection[i]['Foto'] + '">';
                    houseSquare = 'Oppervlakte: ' + collection[i]['Woonoppervlakte'] + ' m' + '<sup>2</sup>';
                    housePrice = 'Prijs: &#8364;' + collection[i]['Koopprijs'];
                    houseMakelaar = 'Makelaar: ' + collection[i]['MakelaarNaam'];
                    houseAdress = collection[i]['Adres'];
                    houseRooms = 'Aantal kamers: ' + collection[i]['AantalKamers'];
                    myLatLng = new google.maps.LatLng(collection[i]['WGS84_Y'], collection[i]['WGS84_X']);
                    houseMarker = new google.maps.Marker({
                        position: myLatLng,
                        map: map,
                        icon: 'images/house-marker.png'
                    });

                    google.maps.event.addListener(map, "mouseover", function() {
                        houseMarker.setIcon("images/MousOver-house-marker.png");
                    });
                    google.maps.event.addListener(map, "mouseout", function() {
                        houseMarker.setIcon("images/house-marker.png");
                    });

                    var details =
                        '<p class="text-center">' +
                        '<h5>' + houseAdress + '</h5>' +
                        housePrice + '<br />' +
                        houseRooms + '<br />' +
                        houseSquare + '<br />' +
                        houseMakelaar + '<br />' +
                        '<div class="img-responsive">' + housePhoto + '</div>'+
                        '</p>';

                    var detailsPopUp = '<p class="text-center">' + houseAdress + ", " + housePrice + '</p>';

                    addInfoWindow(houseMarker, details);
                    addPopupWindow(houseMarker, detailsPopUp);

                }
                var allowedBounds = new google.maps.LatLngBounds(
                    new google.maps.LatLng(50.690492, 3.167453),
                    new google.maps.LatLng(53.587940, 6.993237)
                );
                var lastValidCenter = map.getCenter();

                google.maps.event.addListener(map, 'center_changed', function () {
                    if (allowedBounds.contains(map.getCenter())) {

                        lastValidCenter = map.getCenter();
                        return;
                    }

                    map.panTo(lastValidCenter);
                });
            }

            google.maps.event.addDomListener(window, 'load', initialize);

            function addInfoWindow(houseMarker, details) {
                google.maps.event.addListener(houseMarker, 'click', function () {
                    if (!houseMarker.open) {
                        infoWindow.setContent(details);
                        infoWindow.open(map, houseMarker);
                        houseMarker.open = true;
                    }
                    else {
                        infoWindow.close(map, houseMarker);
                        houseMarker.open = false;
                    }
                });

            }
            function addPopupWindow(houseMarker, detailsPopUp) {
                google.maps.event.addListener(houseMarker, 'mouseover', function () {
                    infoPopUp.setContent(detailsPopUp);
                    infoPopUp.open(map, houseMarker);
                    houseMarker.setIcon("images/MousOver-house-marker.png");
                });

                google.maps.event.addListener(houseMarker, 'mouseout', function () {
                    infoPopUp.close();
                    houseMarker.setIcon("images/house-marker.png");

                });
            }
        </script>
    </div>
</div>

